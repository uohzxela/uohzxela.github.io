<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Authentication on Alex Jiao</title>
    <link>https://www.alexjiao.com/categories/authentication/index.xml</link>
    <description>Recent content in Authentication on Alex Jiao</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en</language>
    <atom:link href="https://www.alexjiao.com/categories/authentication/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Rolling your own simple token-based authentication in AngularJS with Rails</title>
      <link>https://www.alexjiao.com/blog/angular-rails-auth/</link>
      <pubDate>Fri, 01 Aug 2014 02:54:29 +0800</pubDate>
      
      <guid>https://www.alexjiao.com/blog/angular-rails-auth/</guid>
      <description>

&lt;p&gt;Recently I was interested in implementing token-based authentication with a decoupled frontend and backend. I googled about ways to do it the Angular-Rails way. Turns out it is not that simple and straightfoward. After a couple of days of reading fragmented sources of information on the web, I finally rolled my own authentication system.&lt;/p&gt;

&lt;p&gt;Granted that one could easily use Devise gem for their authentication needs, however there’s too much cruft associated with it and I want to implement authentication from the bottom-up to solidify my understanding.&lt;/p&gt;

&lt;p&gt;Given that the resources are scattered out there, I thought I’d write a tutorial to synthesize them into a coherent whole for the benefit of the reader. A large chunk of my tutorial (the Rails backend) is adapted from Michael Hartl’s famous RoR Tutorial, with the rest culled from various resources like StackOverflow and other blogs.&lt;/p&gt;

&lt;p&gt;This tutorial is for those who want to understand how token-based authentication works. We’ll be rolling a simple solution that authenticates users based on their email and password. Log-ins, sign-outs and simple authorization are included as well. I stress that the auth system in this tutorial is definitely not industrial-grade but it won’t be prone to easy hack-ins either.&lt;/p&gt;

&lt;p&gt;You may want to read this article for a rundown of the evolution of API authentication and this article to understand how token-based auth compares with the traditional cookie-based auth.&lt;/p&gt;

&lt;p&gt;We’ll be using token-based auth in this tutorial because it is more conventional and confers more advantages compared to cookie-based auth.&lt;/p&gt;

&lt;p&gt;Even though this tutorial is mainly for developers using Angular and Rails, the process of token-based authentication is generic enough such that a framework-agnostic flow can be gleaned from it:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;Client sends the user provided login credentials to the server.&lt;/li&gt;
&lt;li&gt;Server authenticates credentials and responds with a generated token.&lt;/li&gt;
&lt;li&gt;Client stores the token somewhere (local storage, cookies, or just in memory).&lt;/li&gt;
&lt;li&gt;Client sends the token as an authorization header on every request to the server.&lt;/li&gt;
&lt;li&gt;Server verifies the token and acts accordingly with either sending the requested &amp;gt; resource, or an 401 (or something alike).&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Without further ado, let’s get started.&lt;/p&gt;

&lt;h3 id=&#34;rails-api-setup&#34;&gt;Rails API setup&lt;/h3&gt;

&lt;p&gt;We will be starting a Rails API server from scratch. Run &lt;code&gt;rails new sample-api&lt;/code&gt; in terminal.&lt;/p&gt;

&lt;p&gt;We will be using bcrypt gem as the backbone of our auth machinery. Hence we have to uncomment bcrypt-ruby gem in Gemfile and then do &lt;code&gt;bundle install&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #ffffff&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;gem &lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;bcrypt-ruby&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;~&amp;gt; 3.1.2&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Next, we create our User model. It will have these attributes: name, email, password digest and remember token. We will not be storing passwords in plaintext as hackers can easily retrieve user login credentials through the database. Create the User model by running this command:&lt;/p&gt;

&lt;p&gt;&lt;code&gt;rails g model User name:string email:string password_digest:string remember_token:string&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;In the database migration file auto-generated by the last command, add in a remember token index for easy retrieval since we will be accessing users by their token often.&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #ffffff&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #0000aa&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color: #00aa00; text-decoration: underline&#34;&gt;CreateUsers&lt;/span&gt; &amp;lt; &lt;span style=&#34;color: #aa0000&#34;&gt;ActiveRecord&lt;/span&gt;::&lt;span style=&#34;color: #aa0000&#34;&gt;Migration&lt;/span&gt;
  &lt;span style=&#34;color: #0000aa&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color: #00aa00&#34;&gt;change&lt;/span&gt;
    create_table &lt;span style=&#34;color: #0000aa&#34;&gt;:users&lt;/span&gt; &lt;span style=&#34;color: #0000aa&#34;&gt;do&lt;/span&gt; |t|
      t.string &lt;span style=&#34;color: #0000aa&#34;&gt;:name&lt;/span&gt;
      t.string &lt;span style=&#34;color: #0000aa&#34;&gt;:email&lt;/span&gt;
      t.string &lt;span style=&#34;color: #0000aa&#34;&gt;:password_digest&lt;/span&gt;
      t.string &lt;span style=&#34;color: #0000aa&#34;&gt;:remember_token&lt;/span&gt;

      t.timestamps
    &lt;span style=&#34;color: #0000aa&#34;&gt;end&lt;/span&gt;
    add_index &lt;span style=&#34;color: #0000aa&#34;&gt;:users&lt;/span&gt;, &lt;span style=&#34;color: #0000aa&#34;&gt;:remember_token&lt;/span&gt;
  &lt;span style=&#34;color: #0000aa&#34;&gt;end&lt;/span&gt;
&lt;span style=&#34;color: #0000aa&#34;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Run &lt;code&gt;rake db:migrate&lt;/code&gt; to update the database schema. Your schema should now look like this:&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #ffffff&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #aa0000&#34;&gt;ActiveRecord&lt;/span&gt;::&lt;span style=&#34;color: #aa0000&#34;&gt;Schema&lt;/span&gt;.define(&lt;span style=&#34;color: #0000aa&#34;&gt;version&lt;/span&gt;: &lt;span style=&#34;color: #009999&#34;&gt;20140801074722&lt;/span&gt;) &lt;span style=&#34;color: #0000aa&#34;&gt;do&lt;/span&gt;
  create_table &lt;span style=&#34;color: #aa5500&#34;&gt;&amp;quot;users&amp;quot;&lt;/span&gt;, &lt;span style=&#34;color: #0000aa&#34;&gt;force&lt;/span&gt;: &lt;span style=&#34;color: #0000aa&#34;&gt;true&lt;/span&gt; &lt;span style=&#34;color: #0000aa&#34;&gt;do&lt;/span&gt; |t|
    t.string   &lt;span style=&#34;color: #aa5500&#34;&gt;&amp;quot;name&amp;quot;&lt;/span&gt;
    t.string   &lt;span style=&#34;color: #aa5500&#34;&gt;&amp;quot;email&amp;quot;&lt;/span&gt;
    t.string   &lt;span style=&#34;color: #aa5500&#34;&gt;&amp;quot;password_digest&amp;quot;&lt;/span&gt;
    t.string   &lt;span style=&#34;color: #aa5500&#34;&gt;&amp;quot;remember_token&amp;quot;&lt;/span&gt;
    t.datetime &lt;span style=&#34;color: #aa5500&#34;&gt;&amp;quot;created_at&amp;quot;&lt;/span&gt;
    t.datetime &lt;span style=&#34;color: #aa5500&#34;&gt;&amp;quot;updated_at&amp;quot;&lt;/span&gt;
  &lt;span style=&#34;color: #0000aa&#34;&gt;end&lt;/span&gt;

  add_index &lt;span style=&#34;color: #aa5500&#34;&gt;&amp;quot;users&amp;quot;&lt;/span&gt;, [&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;quot;remember_token&amp;quot;&lt;/span&gt;], &lt;span style=&#34;color: #00aaaa&#34;&gt;name&lt;/span&gt;: &lt;span style=&#34;color: #aa5500&#34;&gt;&amp;quot;index_users_on_remember_token&amp;quot;&lt;/span&gt;
&lt;span style=&#34;color: #0000aa&#34;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Next, we modify our User model class in &lt;code&gt;models/user.rb&lt;/code&gt; to utilise the bcrypt gem by adding &lt;code&gt;has_secure_password&lt;/code&gt;. We will also use some boilerplate from Michael Hartl’s Rails Tutorial (thanks Michael) to validate user’s credentials. Class-level methods used to generate and digest tokens are added as well. Finally, we define a private instance-level method to assign the newly generated token to the &lt;code&gt;remember_token&lt;/code&gt; field of &lt;code&gt;User&lt;/code&gt; model.&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #ffffff&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #0000aa&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color: #00aa00; text-decoration: underline&#34;&gt;User&lt;/span&gt; &amp;lt; &lt;span style=&#34;color: #aa0000&#34;&gt;ActiveRecord&lt;/span&gt;::&lt;span style=&#34;color: #aa0000&#34;&gt;Base&lt;/span&gt;
  has_secure_password &lt;span style=&#34;color: #aaaaaa; font-style: italic&#34;&gt;# using bcrypt&lt;/span&gt;

  &lt;span style=&#34;color: #aaaaaa; font-style: italic&#34;&gt;# boilerplate from Hartl&amp;#39;s tutorial to validate user input&lt;/span&gt;
  before_save { &lt;span style=&#34;color: #00aaaa&#34;&gt;self&lt;/span&gt;.email = email.downcase }
  validates &lt;span style=&#34;color: #0000aa&#34;&gt;:name&lt;/span&gt;, &lt;span style=&#34;color: #0000aa&#34;&gt;presence&lt;/span&gt;: &lt;span style=&#34;color: #0000aa&#34;&gt;true&lt;/span&gt;, &lt;span style=&#34;color: #0000aa&#34;&gt;length&lt;/span&gt;: { &lt;span style=&#34;color: #0000aa&#34;&gt;maximum&lt;/span&gt;: &lt;span style=&#34;color: #009999&#34;&gt;50&lt;/span&gt; }
  &lt;span style=&#34;color: #aa0000&#34;&gt;VALID_EMAIL_REGEX&lt;/span&gt; = &lt;span style=&#34;color: #009999&#34;&gt;/\A[\w+\-.]+@[a-z\d\-.]+\.[a-z]+\z/i&lt;/span&gt;
  validates &lt;span style=&#34;color: #0000aa&#34;&gt;:email&lt;/span&gt;, &lt;span style=&#34;color: #0000aa&#34;&gt;presence&lt;/span&gt;:   &lt;span style=&#34;color: #0000aa&#34;&gt;true&lt;/span&gt;,
                    &lt;span style=&#34;color: #00aaaa&#34;&gt;format&lt;/span&gt;:     { &lt;span style=&#34;color: #0000aa&#34;&gt;with&lt;/span&gt;: &lt;span style=&#34;color: #aa0000&#34;&gt;VALID_EMAIL_REGEX&lt;/span&gt; },
                    &lt;span style=&#34;color: #0000aa&#34;&gt;uniqueness&lt;/span&gt;: { &lt;span style=&#34;color: #0000aa&#34;&gt;case_sensitive&lt;/span&gt;: &lt;span style=&#34;color: #0000aa&#34;&gt;false&lt;/span&gt; }

  validates &lt;span style=&#34;color: #0000aa&#34;&gt;:password&lt;/span&gt;, &lt;span style=&#34;color: #0000aa&#34;&gt;length&lt;/span&gt;: { &lt;span style=&#34;color: #0000aa&#34;&gt;minimum&lt;/span&gt;: &lt;span style=&#34;color: #009999&#34;&gt;6&lt;/span&gt; }
  before_create &lt;span style=&#34;color: #0000aa&#34;&gt;:create_remember_token&lt;/span&gt;

  &lt;span style=&#34;color: #aaaaaa; font-style: italic&#34;&gt;# class-level methods to generate and digest tokens&lt;/span&gt;
  &lt;span style=&#34;color: #0000aa&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color: #00aa00; text-decoration: underline&#34;&gt;User&lt;/span&gt;.&lt;span style=&#34;color: #00aa00&#34;&gt;new_remember_token&lt;/span&gt;
    &lt;span style=&#34;color: #aa0000&#34;&gt;SecureRandom&lt;/span&gt;.urlsafe_base64
  &lt;span style=&#34;color: #0000aa&#34;&gt;end&lt;/span&gt;

  &lt;span style=&#34;color: #0000aa&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color: #00aa00; text-decoration: underline&#34;&gt;User&lt;/span&gt;.&lt;span style=&#34;color: #00aa00&#34;&gt;digest&lt;/span&gt;(token)
    &lt;span style=&#34;color: #aa0000&#34;&gt;Digest&lt;/span&gt;::&lt;span style=&#34;color: #aa0000&#34;&gt;SHA1&lt;/span&gt;.hexdigest(token.to_s)
  &lt;span style=&#34;color: #0000aa&#34;&gt;end&lt;/span&gt;

  &lt;span style=&#34;color: #aaaaaa; font-style: italic&#34;&gt;# private instance-level method to assign token&lt;/span&gt;
  &lt;span style=&#34;color: #0000aa&#34;&gt;private&lt;/span&gt;
    &lt;span style=&#34;color: #0000aa&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color: #00aa00&#34;&gt;create_remember_token&lt;/span&gt;
      &lt;span style=&#34;color: #00aaaa&#34;&gt;self&lt;/span&gt;.remember_token = &lt;span style=&#34;color: #aa0000&#34;&gt;User&lt;/span&gt;.digest(&lt;span style=&#34;color: #aa0000&#34;&gt;User&lt;/span&gt;.new_remember_token)
    &lt;span style=&#34;color: #0000aa&#34;&gt;end&lt;/span&gt;
&lt;span style=&#34;color: #0000aa&#34;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Next, we move on to the controllers. Before creating the users controller, we have to configure the application controller. Since we are decoupling the frontend and the backend, each of them lives in a separate domain. Hence the frontend app have to make cross-domain requests to the Rails backend. Such requests will not be acknowledged unless the server is configured to implement cross-origin resource sharing (CORS).&lt;/p&gt;

&lt;p&gt;As the application controller is the main controller, changes made to it affect the rest of the controllers which inherit from it. Hence it makes sense to implement CORS in application controller.&lt;/p&gt;

&lt;p&gt;Since we are not sending the auth token on the client side through the custom X-CSRF-Token header, we have to change &lt;code&gt;protect_from_forgery&lt;/code&gt; to use &lt;code&gt;:null_session&lt;/code&gt; along with a guard to handle CSRF token verification issue. We included respond_to :json as the Rails API will be mainly serving JSON responses.&lt;/p&gt;

&lt;p&gt;We have also included &lt;code&gt;SessionsHelper&lt;/code&gt; which contains helper methods (to be implemented later) for sign-ins and sign-outs. Finally, there is a callback method used to restrict access to unauthorized users.&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #ffffff&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #0000aa&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color: #00aa00; text-decoration: underline&#34;&gt;ApplicationController&lt;/span&gt; &amp;lt; &lt;span style=&#34;color: #aa0000&#34;&gt;ActionController&lt;/span&gt;::&lt;span style=&#34;color: #aa0000&#34;&gt;Base&lt;/span&gt;
  &lt;span style=&#34;color: #aaaaaa; font-style: italic&#34;&gt;# Prevent CSRF attacks by raising an exception.&lt;/span&gt;
  &lt;span style=&#34;color: #aaaaaa; font-style: italic&#34;&gt;# For APIs, you may want to use :null_session instead.&lt;/span&gt;
  protect_from_forgery &lt;span style=&#34;color: #0000aa&#34;&gt;with&lt;/span&gt;: &lt;span style=&#34;color: #0000aa&#34;&gt;:null_session&lt;/span&gt;, &lt;span style=&#34;color: #0000aa&#34;&gt;if&lt;/span&gt;: &lt;span style=&#34;color: #aa0000&#34;&gt;Proc&lt;/span&gt;.new { |c| c.request.format == &lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;application/json&amp;#39;&lt;/span&gt; }
  &lt;span style=&#34;color: #0000aa&#34;&gt;include&lt;/span&gt; &lt;span style=&#34;color: #aa0000&#34;&gt;SessionsHelper&lt;/span&gt; &lt;span style=&#34;color: #aaaaaa; font-style: italic&#34;&gt;# include helper methods used for sign in and sign out&lt;/span&gt;
  respond_to &lt;span style=&#34;color: #0000aa&#34;&gt;:json&lt;/span&gt;

  before_filter &lt;span style=&#34;color: #0000aa&#34;&gt;:set_cors_headers&lt;/span&gt;
  before_filter &lt;span style=&#34;color: #0000aa&#34;&gt;:cors_preflight&lt;/span&gt;

  &lt;span style=&#34;color: #0000aa&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color: #00aa00&#34;&gt;set_cors_headers&lt;/span&gt;
    headers[&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;Access-Control-Allow-Origin&amp;#39;&lt;/span&gt;] = &lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;*&amp;#39;&lt;/span&gt;
    headers[&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;Access-Control-Allow-Methods&amp;#39;&lt;/span&gt;] = &lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;GET, POST, PUT, DELETE, OPTIONS&amp;#39;&lt;/span&gt;
    headers[&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;Access-Control-Allow-Headers&amp;#39;&lt;/span&gt;] = &lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;Origin, X-Requested-With, Content-Type, Accept, Authorization&amp;#39;&lt;/span&gt;
    headers[&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;Access-Control-Max-Age&amp;#39;&lt;/span&gt;] = &lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;3628800&amp;#39;&lt;/span&gt;
  &lt;span style=&#34;color: #0000aa&#34;&gt;end&lt;/span&gt;

  &lt;span style=&#34;color: #aaaaaa; font-style: italic&#34;&gt;# before every actual request, the browser sends a OPTIONS request &lt;/span&gt;
  &lt;span style=&#34;color: #aaaaaa; font-style: italic&#34;&gt;# to check if the server implements CORS&lt;/span&gt;
  &lt;span style=&#34;color: #aaaaaa; font-style: italic&#34;&gt;# for such requests, send an empty response with 200 status&lt;/span&gt;
  &lt;span style=&#34;color: #0000aa&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color: #00aa00&#34;&gt;cors_preflight&lt;/span&gt;
    head &lt;span style=&#34;color: #0000aa&#34;&gt;:ok&lt;/span&gt; &lt;span style=&#34;color: #0000aa&#34;&gt;if&lt;/span&gt; request.method == &lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;OPTIONS&amp;#39;&lt;/span&gt;
  &lt;span style=&#34;color: #0000aa&#34;&gt;end&lt;/span&gt;

  &lt;span style=&#34;color: #aaaaaa; font-style: italic&#34;&gt;# callback method used for authorization &lt;/span&gt;
  &lt;span style=&#34;color: #0000aa&#34;&gt;private&lt;/span&gt;
    &lt;span style=&#34;color: #0000aa&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color: #00aa00&#34;&gt;restrict_access&lt;/span&gt;
      &lt;span style=&#34;color: #0000aa&#34;&gt;if&lt;/span&gt; request.headers[&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;HTTP_AUTHORIZATION&amp;#39;&lt;/span&gt;]
        token = request.headers[&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;HTTP_AUTHORIZATION&amp;#39;&lt;/span&gt;].split(&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;quot; &amp;quot;&lt;/span&gt;).second
        user = &lt;span style=&#34;color: #aa0000&#34;&gt;User&lt;/span&gt;.find_by(&lt;span style=&#34;color: #0000aa&#34;&gt;remember_token&lt;/span&gt;: &lt;span style=&#34;color: #aa0000&#34;&gt;User&lt;/span&gt;.digest(token))
      &lt;span style=&#34;color: #0000aa&#34;&gt;end&lt;/span&gt;
      head &lt;span style=&#34;color: #0000aa&#34;&gt;:unauthorized&lt;/span&gt; &lt;span style=&#34;color: #0000aa&#34;&gt;unless&lt;/span&gt; user &lt;span style=&#34;color: #aaaaaa; font-style: italic&#34;&gt;# send 401 response unless user is authorized&lt;/span&gt;
    &lt;span style=&#34;color: #0000aa&#34;&gt;end&lt;/span&gt;
&lt;span style=&#34;color: #0000aa&#34;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id=&#34;sign-up-sign-in-and-sign-out&#34;&gt;Sign-up, sign-in and sign-out&lt;/h3&gt;

&lt;p&gt;To implement sign-up, we have to create a Users controller first as this is where we define the creation of new users. Run &lt;code&gt;rails g controller Users&lt;/code&gt; in terminal.&lt;/p&gt;

&lt;p&gt;Define the &lt;code&gt;create&lt;/code&gt; method in &lt;code&gt;controllers/users_controller.rb&lt;/code&gt; as shown below:&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #ffffff&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #0000aa&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color: #00aa00; text-decoration: underline&#34;&gt;UsersController&lt;/span&gt; &amp;lt; &lt;span style=&#34;color: #aa0000&#34;&gt;ApplicationController&lt;/span&gt;
  &lt;span style=&#34;color: #0000aa&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color: #00aa00&#34;&gt;create&lt;/span&gt;
    user = &lt;span style=&#34;color: #aa0000&#34;&gt;User&lt;/span&gt;.new(user_params)
    &lt;span style=&#34;color: #0000aa&#34;&gt;if&lt;/span&gt; user.save
      token = sign_in user
      render &lt;span style=&#34;color: #0000aa&#34;&gt;status&lt;/span&gt;: &lt;span style=&#34;color: #009999&#34;&gt;200&lt;/span&gt;,
        &lt;span style=&#34;color: #0000aa&#34;&gt;json&lt;/span&gt;: {
          &lt;span style=&#34;color: #0000aa&#34;&gt;success&lt;/span&gt;: &lt;span style=&#34;color: #0000aa&#34;&gt;true&lt;/span&gt;,
          &lt;span style=&#34;color: #0000aa&#34;&gt;info&lt;/span&gt;: &lt;span style=&#34;color: #aa5500&#34;&gt;&amp;quot;Signed up successfully&amp;quot;&lt;/span&gt;,
          &lt;span style=&#34;color: #0000aa&#34;&gt;data&lt;/span&gt;: {
            &lt;span style=&#34;color: #0000aa&#34;&gt;auth_token&lt;/span&gt;: token
          }
        }
    &lt;span style=&#34;color: #0000aa&#34;&gt;else&lt;/span&gt;
      render &lt;span style=&#34;color: #0000aa&#34;&gt;status&lt;/span&gt;: &lt;span style=&#34;color: #009999&#34;&gt;200&lt;/span&gt;,
        &lt;span style=&#34;color: #0000aa&#34;&gt;json&lt;/span&gt;: {
          &lt;span style=&#34;color: #0000aa&#34;&gt;success&lt;/span&gt;: &lt;span style=&#34;color: #0000aa&#34;&gt;false&lt;/span&gt;,
          &lt;span style=&#34;color: #0000aa&#34;&gt;info&lt;/span&gt;: &lt;span style=&#34;color: #aa5500&#34;&gt;&amp;quot;Signed up failed, user exists&amp;quot;&lt;/span&gt;,
          &lt;span style=&#34;color: #0000aa&#34;&gt;data&lt;/span&gt;: {}
        }
    &lt;span style=&#34;color: #0000aa&#34;&gt;end&lt;/span&gt;
  &lt;span style=&#34;color: #0000aa&#34;&gt;end&lt;/span&gt;

  &lt;span style=&#34;color: #0000aa&#34;&gt;private&lt;/span&gt;
    &lt;span style=&#34;color: #0000aa&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color: #00aa00&#34;&gt;user_params&lt;/span&gt;
      params.require(&lt;span style=&#34;color: #0000aa&#34;&gt;:user&lt;/span&gt;).permit!
    &lt;span style=&#34;color: #0000aa&#34;&gt;end&lt;/span&gt;
&lt;span style=&#34;color: #0000aa&#34;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The alert reader can see that &lt;code&gt;sign_in&lt;/code&gt; method is not defined in this class; it is defined in &lt;code&gt;SessionsHelper&lt;/code&gt; module instead. Since we want the user to be automatically signed in after registration, we have to proceed with the implementation of sign-in process, and followed by sign-out. This is done with sessions. A session is considered as a resource in the server, hence we have to create a controller for it.&lt;/p&gt;

&lt;p&gt;Run &lt;code&gt;rails g controller Sessions&lt;/code&gt; to create the &lt;code&gt;SessionsController&lt;/code&gt;. As a side-effect, &lt;code&gt;SessionsHelper&lt;/code&gt; is automatically created too.&lt;/p&gt;

&lt;p&gt;Let’s define the &lt;code&gt;create&lt;/code&gt; and &lt;code&gt;destroy&lt;/code&gt; methods in &lt;code&gt;controllers/sessions_controller.rb&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #ffffff&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #0000aa&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color: #00aa00; text-decoration: underline&#34;&gt;SessionsController&lt;/span&gt; &amp;lt; &lt;span style=&#34;color: #aa0000&#34;&gt;ApplicationController&lt;/span&gt;
  &lt;span style=&#34;color: #0000aa&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color: #00aa00&#34;&gt;create&lt;/span&gt;
    user = &lt;span style=&#34;color: #aa0000&#34;&gt;User&lt;/span&gt;.find_by(&lt;span style=&#34;color: #0000aa&#34;&gt;email&lt;/span&gt;: params[&lt;span style=&#34;color: #0000aa&#34;&gt;:user&lt;/span&gt;][&lt;span style=&#34;color: #0000aa&#34;&gt;:email&lt;/span&gt;].downcase)
    &lt;span style=&#34;color: #0000aa&#34;&gt;if&lt;/span&gt; user &amp;amp;&amp;amp; user.authenticate(params[&lt;span style=&#34;color: #0000aa&#34;&gt;:user&lt;/span&gt;][&lt;span style=&#34;color: #0000aa&#34;&gt;:password&lt;/span&gt;])
      &lt;span style=&#34;color: #aaaaaa; font-style: italic&#34;&gt;#sign_in helper method from SessionsHelper&lt;/span&gt;
      token = sign_in user
      render &lt;span style=&#34;color: #0000aa&#34;&gt;status&lt;/span&gt;: &lt;span style=&#34;color: #009999&#34;&gt;200&lt;/span&gt;,
        &lt;span style=&#34;color: #0000aa&#34;&gt;json&lt;/span&gt;: {
          &lt;span style=&#34;color: #0000aa&#34;&gt;success&lt;/span&gt;: &lt;span style=&#34;color: #0000aa&#34;&gt;true&lt;/span&gt;,
          &lt;span style=&#34;color: #0000aa&#34;&gt;info&lt;/span&gt;: &lt;span style=&#34;color: #aa5500&#34;&gt;&amp;quot;Logged in successfully&amp;quot;&lt;/span&gt;,
          &lt;span style=&#34;color: #0000aa&#34;&gt;data&lt;/span&gt;: {
            &lt;span style=&#34;color: #0000aa&#34;&gt;auth_token&lt;/span&gt;: token
          }
        }
    &lt;span style=&#34;color: #0000aa&#34;&gt;else&lt;/span&gt;
      render &lt;span style=&#34;color: #0000aa&#34;&gt;status&lt;/span&gt;: &lt;span style=&#34;color: #009999&#34;&gt;200&lt;/span&gt;,
      &lt;span style=&#34;color: #0000aa&#34;&gt;json&lt;/span&gt;: {
        &lt;span style=&#34;color: #0000aa&#34;&gt;success&lt;/span&gt;: &lt;span style=&#34;color: #0000aa&#34;&gt;false&lt;/span&gt;,
        &lt;span style=&#34;color: #0000aa&#34;&gt;info&lt;/span&gt;: &lt;span style=&#34;color: #aa5500&#34;&gt;&amp;quot;Log in failed&amp;quot;&lt;/span&gt;,
        &lt;span style=&#34;color: #0000aa&#34;&gt;data&lt;/span&gt;: {}
      }
    &lt;span style=&#34;color: #0000aa&#34;&gt;end&lt;/span&gt;
  &lt;span style=&#34;color: #0000aa&#34;&gt;end&lt;/span&gt;

  &lt;span style=&#34;color: #0000aa&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color: #00aa00&#34;&gt;destroy&lt;/span&gt;
    &lt;span style=&#34;color: #0000aa&#34;&gt;if&lt;/span&gt; request.headers[&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;HTTP_AUTHORIZATION&amp;#39;&lt;/span&gt;]
      token = request.headers[&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;HTTP_AUTHORIZATION&amp;#39;&lt;/span&gt;].split(&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;quot; &amp;quot;&lt;/span&gt;).second
      user = &lt;span style=&#34;color: #aa0000&#34;&gt;User&lt;/span&gt;.find_by(&lt;span style=&#34;color: #0000aa&#34;&gt;remember_token&lt;/span&gt;: &lt;span style=&#34;color: #aa0000&#34;&gt;User&lt;/span&gt;.digest(token))
    &lt;span style=&#34;color: #0000aa&#34;&gt;end&lt;/span&gt;
    &lt;span style=&#34;color: #0000aa&#34;&gt;if&lt;/span&gt; user
      &lt;span style=&#34;color: #aaaaaa; font-style: italic&#34;&gt;#sign_out helper method from SessionsHelper&lt;/span&gt;
      sign_out user
      render &lt;span style=&#34;color: #0000aa&#34;&gt;status&lt;/span&gt;: &lt;span style=&#34;color: #009999&#34;&gt;200&lt;/span&gt;,
        &lt;span style=&#34;color: #0000aa&#34;&gt;json&lt;/span&gt;: {
          &lt;span style=&#34;color: #0000aa&#34;&gt;success&lt;/span&gt;: &lt;span style=&#34;color: #0000aa&#34;&gt;true&lt;/span&gt;,
          &lt;span style=&#34;color: #0000aa&#34;&gt;info&lt;/span&gt;: &lt;span style=&#34;color: #aa5500&#34;&gt;&amp;quot;Signed out successfully&amp;quot;&lt;/span&gt;,
          &lt;span style=&#34;color: #0000aa&#34;&gt;data&lt;/span&gt;: {}
        }
    &lt;span style=&#34;color: #0000aa&#34;&gt;else&lt;/span&gt;
      render &lt;span style=&#34;color: #0000aa&#34;&gt;status&lt;/span&gt;: &lt;span style=&#34;color: #009999&#34;&gt;200&lt;/span&gt;,
      &lt;span style=&#34;color: #0000aa&#34;&gt;json&lt;/span&gt;: {
        &lt;span style=&#34;color: #0000aa&#34;&gt;success&lt;/span&gt;: &lt;span style=&#34;color: #0000aa&#34;&gt;false&lt;/span&gt;,
        &lt;span style=&#34;color: #0000aa&#34;&gt;info&lt;/span&gt;: &lt;span style=&#34;color: #aa5500&#34;&gt;&amp;quot;Signed out failed, no such user&amp;quot;&lt;/span&gt;,
        &lt;span style=&#34;color: #0000aa&#34;&gt;data&lt;/span&gt;: {}
      }
    &lt;span style=&#34;color: #0000aa&#34;&gt;end&lt;/span&gt;
  &lt;span style=&#34;color: #0000aa&#34;&gt;end&lt;/span&gt;
&lt;span style=&#34;color: #0000aa&#34;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Looking at the above code, there’s nothing out of the ordinary except for this snippet &lt;code&gt;user.authenticate(params[:user][:password])&lt;/code&gt;. The &lt;code&gt;authenticate()&lt;/code&gt; method is part of the bcrypt gem, and is used to digest the given password to compare it with the stored password digest in the users database, returning a boolean value.&lt;/p&gt;

&lt;p&gt;We also observe that we invoke the helper methods from the &lt;code&gt;SessionsHelper&lt;/code&gt; module in &lt;code&gt;helpers/sessions_helper.rb&lt;/code&gt;. Without further ado, let’s flesh the module out.&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #ffffff&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #0000aa&#34;&gt;module&lt;/span&gt; &lt;span style=&#34;color: #00aaaa; text-decoration: underline&#34;&gt;SessionsHelper&lt;/span&gt;
  &lt;span style=&#34;color: #0000aa&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color: #00aa00&#34;&gt;sign_in&lt;/span&gt;(user)
    remember_token = &lt;span style=&#34;color: #aa0000&#34;&gt;User&lt;/span&gt;.new_remember_token
    user.update_attribute(&lt;span style=&#34;color: #0000aa&#34;&gt;:remember_token&lt;/span&gt;, &lt;span style=&#34;color: #aa0000&#34;&gt;User&lt;/span&gt;.digest(remember_token))
    remember_token
  &lt;span style=&#34;color: #0000aa&#34;&gt;end&lt;/span&gt;

  &lt;span style=&#34;color: #0000aa&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color: #00aa00&#34;&gt;sign_out&lt;/span&gt;(user)
    user.update_attribute(&lt;span style=&#34;color: #0000aa&#34;&gt;:remember_token&lt;/span&gt;, &lt;span style=&#34;color: #aa0000&#34;&gt;User&lt;/span&gt;.digest(&lt;span style=&#34;color: #aa0000&#34;&gt;User&lt;/span&gt;.new_remember_token))
  &lt;span style=&#34;color: #0000aa&#34;&gt;end&lt;/span&gt;
&lt;span style=&#34;color: #0000aa&#34;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id=&#34;simple-authorization&#34;&gt;Simple authorization&lt;/h3&gt;

&lt;p&gt;Let’s define a restricted API call to illustrate the authorization concept. We make it such that only logged-in users can access the index of all users from the API.&lt;/p&gt;

&lt;p&gt;We return to &lt;code&gt;controllers/users_controller.rb&lt;/code&gt; to effect this change by defining the index method and using a &lt;code&gt;before_action&lt;/code&gt; callback hook to restrict access to it.&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #ffffff&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #0000aa&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color: #00aa00; text-decoration: underline&#34;&gt;UsersController&lt;/span&gt; &amp;lt; &lt;span style=&#34;color: #aa0000&#34;&gt;ApplicationController&lt;/span&gt;
  before_action &lt;span style=&#34;color: #0000aa&#34;&gt;:restrict_access&lt;/span&gt;, &lt;span style=&#34;color: #0000aa&#34;&gt;only&lt;/span&gt;: &lt;span style=&#34;color: #0000aa&#34;&gt;:index&lt;/span&gt;
  &lt;span style=&#34;color: #0000aa&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color: #00aa00&#34;&gt;index&lt;/span&gt;
    respond_with &lt;span style=&#34;color: #aa0000&#34;&gt;User&lt;/span&gt;.all
  &lt;span style=&#34;color: #0000aa&#34;&gt;end&lt;/span&gt;

  &lt;span style=&#34;color: #aaaaaa; font-style: italic&#34;&gt;# rest of the code here&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The &lt;code&gt;restrict_access&lt;/code&gt; method is defined in &lt;code&gt;ApplicationController&lt;/code&gt; and &lt;code&gt;UsersController&lt;/code&gt; is a subclass of it. That’s why we are able to invoke &lt;code&gt;restrict_access&lt;/code&gt; method here.&lt;/p&gt;

&lt;p&gt;The &lt;code&gt;index&lt;/code&gt; method will respond with a JSON containing all users, this is made possible by the &lt;code&gt;respond_to :json&lt;/code&gt; method in &lt;code&gt;ApplicationController&lt;/code&gt;.&lt;/p&gt;

&lt;h3 id=&#34;routings&#34;&gt;Routings&lt;/h3&gt;

&lt;p&gt;This is the final part of our Rails API. We have to tie up the loose ends by connecting the methods in our controllers to the API endpoints – the URLs.&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #ffffff&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #aa0000&#34;&gt;Rails&lt;/span&gt;.application.routes.draw &lt;span style=&#34;color: #0000aa&#34;&gt;do&lt;/span&gt;
  resources &lt;span style=&#34;color: #0000aa&#34;&gt;:users&lt;/span&gt;, &lt;span style=&#34;color: #0000aa&#34;&gt;defaults&lt;/span&gt;: {&lt;span style=&#34;color: #00aaaa&#34;&gt;format&lt;/span&gt;: &lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;json&amp;#39;&lt;/span&gt;}
  match &lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;/users&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color: #0000aa&#34;&gt;to&lt;/span&gt;: &lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;users#set_cors_headers&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color: #0000aa&#34;&gt;via&lt;/span&gt;: &lt;span style=&#34;color: #0000aa&#34;&gt;:options&lt;/span&gt;
  resources &lt;span style=&#34;color: #0000aa&#34;&gt;:sessions&lt;/span&gt;
  match &lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;/signin&amp;#39;&lt;/span&gt;,    &lt;span style=&#34;color: #0000aa&#34;&gt;to&lt;/span&gt;: &lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;sessions#create&amp;#39;&lt;/span&gt;,    &lt;span style=&#34;color: #0000aa&#34;&gt;via&lt;/span&gt;: [&lt;span style=&#34;color: #0000aa&#34;&gt;:post&lt;/span&gt;, &lt;span style=&#34;color: #0000aa&#34;&gt;:options&lt;/span&gt;]
  match &lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;/signout&amp;#39;&lt;/span&gt;,   &lt;span style=&#34;color: #0000aa&#34;&gt;to&lt;/span&gt;: &lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;sessions#destroy&amp;#39;&lt;/span&gt;,   &lt;span style=&#34;color: #0000aa&#34;&gt;via&lt;/span&gt;: [&lt;span style=&#34;color: #0000aa&#34;&gt;:delete&lt;/span&gt;, &lt;span style=&#34;color: #0000aa&#34;&gt;:options&lt;/span&gt;]
  match &lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;/signup&amp;#39;&lt;/span&gt;,    &lt;span style=&#34;color: #0000aa&#34;&gt;to&lt;/span&gt;: &lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;users#create&amp;#39;&lt;/span&gt;,       &lt;span style=&#34;color: #0000aa&#34;&gt;via&lt;/span&gt;: [&lt;span style=&#34;color: #0000aa&#34;&gt;:post&lt;/span&gt;, &lt;span style=&#34;color: #0000aa&#34;&gt;:options&lt;/span&gt;]
&lt;span style=&#34;color: #0000aa&#34;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We have to take care of CORs preflight by specifying that the API endpoints can respond to OPTIONS request.&lt;/p&gt;

&lt;p&gt;Notice that even though we defined every possible RESTful endpoints for &lt;code&gt;/users&lt;/code&gt; using &lt;code&gt;resources :users, defaults: {format: &#39;json&#39;}&lt;/code&gt;, we still have to handle the OPTION request for &lt;code&gt;/users&lt;/code&gt; by directing it to &lt;code&gt;set_cors_headers&lt;/code&gt; method defined in &lt;code&gt;ApplicationController&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;To be honest, I’m not sure whether my approach is considered best practice or not. Either way, it doesn’t look elegant. If you have any better solutions, do let me know!&lt;/p&gt;

&lt;p&gt;This concludes the set-up for Rails API.&lt;/p&gt;

&lt;h3 id=&#34;setting-up-the-angular-frontend&#34;&gt;Setting up the Angular frontend&lt;/h3&gt;

&lt;p&gt;We will be creating a sample app using Angular framework. I’ll assume that the reader has already scaffolded the app with Yeoman.&lt;/p&gt;

&lt;p&gt;If you haven’t already, please follow this &lt;a href=&#34;http://yeoman.io/codelab/index.html&#34;&gt;codelab&lt;/a&gt; until Step 5.&lt;/p&gt;

&lt;p&gt;We will need to configure our Angular app by adding a dependency to store auth tokens on the client side.&lt;/p&gt;

&lt;p&gt;First, we run &lt;code&gt;bower install --save angular-local-storage&lt;/code&gt; in terminal to install the local storage module.&lt;/p&gt;

&lt;p&gt;We then have to edit the application module in &lt;code&gt;scripts/app.js&lt;/code&gt; to include the local storage module:&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #ffffff&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #0000aa&#34;&gt;var&lt;/span&gt; app = angular
  .module(&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;sampleAppApp&amp;#39;&lt;/span&gt;, [
    &lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;ngAnimate&amp;#39;&lt;/span&gt;,
    &lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;ngCookies&amp;#39;&lt;/span&gt;,
    &lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;ngResource&amp;#39;&lt;/span&gt;,
    &lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;ngRoute&amp;#39;&lt;/span&gt;,
    &lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;ngSanitize&amp;#39;&lt;/span&gt;,
    &lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;ngTouch&amp;#39;&lt;/span&gt;,
    &lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;LocalStorageModule&amp;#39;&lt;/span&gt;
  ]);
  app.config([&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;localStorageServiceProvider&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color: #0000aa&#34;&gt;function&lt;/span&gt;(localStorageServiceProvider){
    localStorageServiceProvider.setPrefix(&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;ls&amp;#39;&lt;/span&gt;);
  }]);
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Just a caveat: Yeoman named my app as &lt;code&gt;sampleAppApp&lt;/code&gt; because I ran &lt;code&gt;yo angular&lt;/code&gt; in a folder named &lt;code&gt;sample-app&lt;/code&gt;. Please replace &lt;code&gt;sampleAppApp&lt;/code&gt; with the name that Yeoman generated for you.&lt;/p&gt;

&lt;p&gt;Notice that we assigned the application module to a variable app. This is used to easily refer to the application module later on.&lt;/p&gt;

&lt;p&gt;We also have to configure the local storage module by setting its prefix to avoid namespace conflicts.&lt;/p&gt;

&lt;p&gt;Moving on, we lay out the routings in the application module:&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #ffffff&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt; app.config(&lt;span style=&#34;color: #0000aa&#34;&gt;function&lt;/span&gt; ($routeProvider) {
  $routeProvider
    .when(&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;/&amp;#39;&lt;/span&gt;, {
      templateUrl: &lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;views/main.html&amp;#39;&lt;/span&gt;,
      controller: &lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;MainCtrl&amp;#39;&lt;/span&gt;
    })
    .when(&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;/about&amp;#39;&lt;/span&gt;, {
      templateUrl: &lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;views/about.html&amp;#39;&lt;/span&gt;,
      controller: &lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;AboutCtrl&amp;#39;&lt;/span&gt;
    })
    .when(&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;/login&amp;#39;&lt;/span&gt;, {
      templateUrl: &lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;views/login.html&amp;#39;&lt;/span&gt;,
      controller: &lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;LoginCtrl&amp;#39;&lt;/span&gt;
    })
    .when(&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;/signup&amp;#39;&lt;/span&gt;, {
      templateUrl: &lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;views/signup.html&amp;#39;&lt;/span&gt;,
      controller: &lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;SignupCtrl&amp;#39;&lt;/span&gt;
    })
    .when(&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;/signout&amp;#39;&lt;/span&gt;, {
      templateUrl: &lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;views/signout.html&amp;#39;&lt;/span&gt;,
      controller: &lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;SignoutCtrl&amp;#39;&lt;/span&gt;
    })
    .when(&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;/restricted&amp;#39;&lt;/span&gt;, {
      templateUrl: &lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;views/users.html&amp;#39;&lt;/span&gt;,
      controller: &lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;UsersCtrl&amp;#39;&lt;/span&gt;
    })
    .otherwise({
      redirectTo: &lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;/&amp;#39;&lt;/span&gt;
    });
  })
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;In addition to the two default routes created by Yeoman, we now have four routes, with one route being restricted only to authorized users.&lt;/p&gt;

&lt;p&gt;Having defined the routings, we proceed to flesh out the rest of the app by creating the controllers and the views.&lt;/p&gt;

&lt;p&gt;We start with the sign-up controller by creating a new file in &lt;code&gt;scripts/controllers/signup.js&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #ffffff&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;app.controller(&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;SignupCtrl&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color: #0000aa&#34;&gt;function&lt;/span&gt;($location, $scope, $http, localStorageService) {
  $scope.user = {};
  &lt;span style=&#34;color: #0000aa&#34;&gt;if&lt;/span&gt; (localStorageService.get(&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;token&amp;#39;&lt;/span&gt;)) {
      $scope.info = &lt;span style=&#34;color: #aa5500&#34;&gt;&amp;quot;Logged in&amp;quot;&lt;/span&gt; ;
  }
  $scope.signup = &lt;span style=&#34;color: #0000aa&#34;&gt;function&lt;/span&gt;() {
      console.log($scope.user);
      $http({
          url: &lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;http://localhost:3000/signup&amp;#39;&lt;/span&gt;,
          method: &lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;POST&amp;#39;&lt;/span&gt;,
          data: {
              user: $scope.user
          }
      }).success(&lt;span style=&#34;color: #0000aa&#34;&gt;function&lt;/span&gt;(response){
          $scope.info = response.info;
          localStorageService.set(&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;token&amp;#39;&lt;/span&gt;, response.data.auth_token)
      });
  };
});
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;In this controller, we make a POST request containing user credentials to the Rails API (port number 3000). If successful, the API will return an auth token which will be stored in the local storage. We also display the relevant information in the API response so that we know whether the sign-up is successful or not.&lt;/p&gt;

&lt;p&gt;Now we need to create a sign-up form to carry out form-based authentication. Let’s create a new file in &lt;code&gt;views/signup.html&lt;/code&gt; and add the HTML as follows:&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #ffffff&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;&amp;lt;&lt;span style=&#34;color: #1e90ff; font-weight: bold&#34;&gt;form&lt;/span&gt; &lt;span style=&#34;color: #1e90ff&#34;&gt;ng-submit&lt;/span&gt;=&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;quot;signup()&amp;quot;&lt;/span&gt; &lt;span style=&#34;color: #1e90ff&#34;&gt;class&lt;/span&gt;=&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;quot;well&amp;quot;&lt;/span&gt;&amp;gt;
  &amp;lt;&lt;span style=&#34;color: #1e90ff; font-weight: bold&#34;&gt;h3&lt;/span&gt;&amp;gt;Sign up&amp;lt;/&lt;span style=&#34;color: #1e90ff; font-weight: bold&#34;&gt;h3&lt;/span&gt;&amp;gt;
  &amp;lt;&lt;span style=&#34;color: #1e90ff; font-weight: bold&#34;&gt;input&lt;/span&gt; &lt;span style=&#34;color: #1e90ff&#34;&gt;ng-model&lt;/span&gt;=&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;quot;user.name&amp;quot;&lt;/span&gt; &lt;span style=&#34;color: #1e90ff&#34;&gt;type&lt;/span&gt;=&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;quot;text&amp;quot;&lt;/span&gt; &lt;span style=&#34;color: #1e90ff&#34;&gt;placeholder&lt;/span&gt;=&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;quot;Name&amp;quot;&lt;/span&gt;&amp;gt;
  &amp;lt;&lt;span style=&#34;color: #1e90ff; font-weight: bold&#34;&gt;input&lt;/span&gt; &lt;span style=&#34;color: #1e90ff&#34;&gt;ng-model&lt;/span&gt;=&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;quot;user.email&amp;quot;&lt;/span&gt; &lt;span style=&#34;color: #1e90ff&#34;&gt;type&lt;/span&gt;=&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;quot;text&amp;quot;&lt;/span&gt; &lt;span style=&#34;color: #1e90ff&#34;&gt;placeholder&lt;/span&gt;=&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;quot;Email&amp;quot;&lt;/span&gt;&amp;gt;
  &amp;lt;&lt;span style=&#34;color: #1e90ff; font-weight: bold&#34;&gt;input&lt;/span&gt; &lt;span style=&#34;color: #1e90ff&#34;&gt;ng-model&lt;/span&gt;=&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;quot;user.password&amp;quot;&lt;/span&gt; &lt;span style=&#34;color: #1e90ff&#34;&gt;type&lt;/span&gt;=&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;quot;password&amp;quot;&lt;/span&gt; &lt;span style=&#34;color: #1e90ff&#34;&gt;placeholder&lt;/span&gt;=&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;quot;Password&amp;quot;&lt;/span&gt;&amp;gt;
  &amp;lt;&lt;span style=&#34;color: #1e90ff; font-weight: bold&#34;&gt;input&lt;/span&gt; &lt;span style=&#34;color: #1e90ff&#34;&gt;ng-model&lt;/span&gt;=&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;quot;user.password_confirmation&amp;quot;&lt;/span&gt; &lt;span style=&#34;color: #1e90ff&#34;&gt;type&lt;/span&gt;=&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;quot;password&amp;quot;&lt;/span&gt; &lt;span style=&#34;color: #1e90ff&#34;&gt;placeholder&lt;/span&gt;=&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;quot;Confirm password&amp;quot;&lt;/span&gt;&amp;gt;
  &amp;lt;&lt;span style=&#34;color: #1e90ff; font-weight: bold&#34;&gt;button&lt;/span&gt; &lt;span style=&#34;color: #1e90ff&#34;&gt;type&lt;/span&gt;=&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;quot;submit&amp;quot;&lt;/span&gt; &lt;span style=&#34;color: #1e90ff&#34;&gt;class&lt;/span&gt;=&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;quot;btn&amp;quot;&lt;/span&gt;&amp;gt;Sign up&amp;lt;/&lt;span style=&#34;color: #1e90ff; font-weight: bold&#34;&gt;button&lt;/span&gt;&amp;gt;
&amp;lt;/&lt;span style=&#34;color: #1e90ff; font-weight: bold&#34;&gt;form&lt;/span&gt;&amp;gt;

&amp;lt;&lt;span style=&#34;color: #1e90ff; font-weight: bold&#34;&gt;div&lt;/span&gt;&amp;gt;
  { { info } }
  &lt;span style=&#34;color: #aaaaaa; font-style: italic&#34;&gt;&amp;lt;!-- please remove spacing between curly brackets! --&amp;gt;&lt;/span&gt;
&amp;lt;/&lt;span style=&#34;color: #1e90ff; font-weight: bold&#34;&gt;div&lt;/span&gt;&amp;gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Our user credentials consist of four parameters: name, email, password and password confirmation. The last parameter may seem optional, but it is required by bcrypt to generate a password digest.&lt;/p&gt;

&lt;p&gt;We have also included a string interpolation enclosed in a div block to display result of the log-in process. As Markdown is unable to escape double curly brackets, I deliberately added a space between them. You have to remove the spacing to make Angular’s string interpolation work.&lt;/p&gt;

&lt;p&gt;At this point you may wish to test out the app and API by running &lt;code&gt;grunt serve&lt;/code&gt; and &lt;code&gt;rails s&lt;/code&gt; respectively. But don’t forget to include the &lt;code&gt;signup.js&lt;/code&gt; file in the index.html.&lt;/p&gt;

&lt;p&gt;If there’s no problem, perfect! Moving on, we will create the log-in controller (&lt;code&gt;scripts/controllers/login.js&lt;/code&gt;):&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #ffffff&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;app.controller(&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;LoginCtrl&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color: #0000aa&#34;&gt;function&lt;/span&gt;($location, $scope, $http, localStorageService) {
  &lt;span style=&#34;color: #0000aa&#34;&gt;if&lt;/span&gt; (localStorageService.get(&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;token&amp;#39;&lt;/span&gt;)) {
    $scope.info = &lt;span style=&#34;color: #aa5500&#34;&gt;&amp;quot;Logged in&amp;quot;&lt;/span&gt;;
  }
  $scope.login = &lt;span style=&#34;color: #0000aa&#34;&gt;function&lt;/span&gt;() {
    $http({
      url: &lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;http://localhost:3000/signin&amp;#39;&lt;/span&gt;,
      method: &lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;POST&amp;#39;&lt;/span&gt;,
      data: {
        user: $scope.user
      }
    }).success(&lt;span style=&#34;color: #0000aa&#34;&gt;function&lt;/span&gt;(response){
      $scope.info = response.info;
      localStorageService.set(&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;token&amp;#39;&lt;/span&gt;, response.data.auth_token)
    });
  };
});
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The log-in controller is more or less the same as sign-up controller. The difference lies in the parameters passed to API. Log-in process is simpler, requiring only two parameters: email and password. The email is used to find the user, and the password is used for authentication. Let’s flesh out the form used to input the log-in parameters in &lt;code&gt;views/login.html&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #ffffff&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;&amp;lt;&lt;span style=&#34;color: #1e90ff; font-weight: bold&#34;&gt;form&lt;/span&gt; &lt;span style=&#34;color: #1e90ff&#34;&gt;ng-submit&lt;/span&gt;=&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;quot;login()&amp;quot;&lt;/span&gt; &lt;span style=&#34;color: #1e90ff&#34;&gt;class&lt;/span&gt;=&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;quot;well form-inline&amp;quot;&lt;/span&gt;&amp;gt;
  &amp;lt;&lt;span style=&#34;color: #1e90ff; font-weight: bold&#34;&gt;h3&lt;/span&gt;&amp;gt;Login&amp;lt;/&lt;span style=&#34;color: #1e90ff; font-weight: bold&#34;&gt;h3&lt;/span&gt;&amp;gt;
  &amp;lt;&lt;span style=&#34;color: #1e90ff; font-weight: bold&#34;&gt;input&lt;/span&gt; &lt;span style=&#34;color: #1e90ff&#34;&gt;ng-model&lt;/span&gt;=&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;quot;user.email&amp;quot;&lt;/span&gt; &lt;span style=&#34;color: #1e90ff&#34;&gt;type&lt;/span&gt;=&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;quot;text&amp;quot;&lt;/span&gt; &lt;span style=&#34;color: #1e90ff&#34;&gt;placeholder&lt;/span&gt;=&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;quot;Email&amp;quot;&lt;/span&gt;&amp;gt;
  &amp;lt;&lt;span style=&#34;color: #1e90ff; font-weight: bold&#34;&gt;input&lt;/span&gt; &lt;span style=&#34;color: #1e90ff&#34;&gt;ng-model&lt;/span&gt;=&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;quot;user.password&amp;quot;&lt;/span&gt; &lt;span style=&#34;color: #1e90ff&#34;&gt;type&lt;/span&gt;=&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;quot;password&amp;quot;&lt;/span&gt; &lt;span style=&#34;color: #1e90ff&#34;&gt;placeholder&lt;/span&gt;=&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;quot;Password&amp;quot;&lt;/span&gt;&amp;gt;
  &amp;lt;&lt;span style=&#34;color: #1e90ff; font-weight: bold&#34;&gt;button&lt;/span&gt; &lt;span style=&#34;color: #1e90ff&#34;&gt;type&lt;/span&gt;=&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;quot;submit&amp;quot;&lt;/span&gt; &lt;span style=&#34;color: #1e90ff&#34;&gt;class&lt;/span&gt;=&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;quot;btn&amp;quot;&lt;/span&gt;&amp;gt;Log in&amp;lt;/&lt;span style=&#34;color: #1e90ff; font-weight: bold&#34;&gt;button&lt;/span&gt;&amp;gt;
  &amp;lt;&lt;span style=&#34;color: #1e90ff; font-weight: bold&#34;&gt;button&lt;/span&gt; &lt;span style=&#34;color: #1e90ff&#34;&gt;ng-click&lt;/span&gt;=&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;quot;signup()&amp;quot;&lt;/span&gt; &lt;span style=&#34;color: #1e90ff&#34;&gt;class&lt;/span&gt;=&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;quot;btn&amp;quot;&lt;/span&gt;&amp;gt;Sign up&amp;lt;/&lt;span style=&#34;color: #1e90ff; font-weight: bold&#34;&gt;button&lt;/span&gt;&amp;gt;
&amp;lt;/&lt;span style=&#34;color: #1e90ff; font-weight: bold&#34;&gt;form&lt;/span&gt;&amp;gt;

&amp;lt;&lt;span style=&#34;color: #1e90ff; font-weight: bold&#34;&gt;div&lt;/span&gt;&amp;gt;
  { { info } }
  &lt;span style=&#34;color: #aaaaaa; font-style: italic&#34;&gt;&amp;lt;!-- please remove spacing between curly brackets! --&amp;gt;&lt;/span&gt;
&amp;lt;/&lt;span style=&#34;color: #1e90ff; font-weight: bold&#34;&gt;div&lt;/span&gt;&amp;gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Finally, we complete the authentication cycle by fleshing out the sign-out controller in &lt;code&gt;scripts/controllers/signout.js&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #ffffff&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;app.controller(&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;SignoutCtrl&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color: #0000aa&#34;&gt;function&lt;/span&gt;($location, $scope, $http, localStorageService) {
  $scope.signout = &lt;span style=&#34;color: #0000aa&#34;&gt;function&lt;/span&gt;() {
    $http({
      url: &lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;http://localhost:3000/signout&amp;#39;&lt;/span&gt;,
      method: &lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;DELETE&amp;#39;&lt;/span&gt;,
      data: {}
    }).success(&lt;span style=&#34;color: #0000aa&#34;&gt;function&lt;/span&gt;(response){
      $scope.info = response.info;
      localStorageService.remove(&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;token&amp;#39;&lt;/span&gt;)
    });
  };
  $scope.signout();
});
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Here, we make a DELETE request to the API, if successful, we clear the token in local storage and return the relevant information to be displayed.&lt;/p&gt;

&lt;p&gt;The sign-out view (&lt;code&gt;views/signout.html&lt;/code&gt;) is a just a HTML file to display the result:&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #ffffff&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;&amp;lt;&lt;span style=&#34;color: #1e90ff; font-weight: bold&#34;&gt;div&lt;/span&gt;&amp;gt;
  { { info } }
  &lt;span style=&#34;color: #aaaaaa; font-style: italic&#34;&gt;&amp;lt;!-- please remove spacing between curly brackets! --&amp;gt;&lt;/span&gt;
&amp;lt;/&lt;span style=&#34;color: #1e90ff; font-weight: bold&#34;&gt;div&lt;/span&gt;&amp;gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id=&#34;http-interceptors-and-authorization&#34;&gt;HTTP interceptors and authorization&lt;/h3&gt;

&lt;p&gt;The alert reader may notice that we didn’t pass anything to the body of the DELETE request. So how do the API know which user to delete the session for?&lt;/p&gt;

&lt;p&gt;Even though the authentication cycle is compete, we still have to construct the underlying pipes of our Angular app to make it work.&lt;/p&gt;

&lt;p&gt;The idea is that the HTTP request headers should contain the token every time we make a request. How do we do that?&lt;/p&gt;

&lt;p&gt;Turns out Angular has a built-in service to modify the HTTP request message before it is being sent to the server. We shall use a subset of the &lt;code&gt;$http service&lt;/code&gt; – HTTP interceptors – for this purpose.&lt;/p&gt;

&lt;p&gt;Let’s create a file named &lt;code&gt;auth-interceptor.js&lt;/code&gt; in &lt;code&gt;scripts/services&lt;/code&gt; folder (create the folder if you haven’t) and add the code as shown below:&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #ffffff&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;app.factory(&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;AuthInterceptor&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color: #0000aa&#34;&gt;function&lt;/span&gt;(localStorageService, $q, $location) {
  &lt;span style=&#34;color: #0000aa&#34;&gt;return&lt;/span&gt; {
      request: &lt;span style=&#34;color: #0000aa&#34;&gt;function&lt;/span&gt;(config) {
          config.headers = config.headers || {};
          &lt;span style=&#34;color: #0000aa&#34;&gt;if&lt;/span&gt; (localStorageService.get(&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;token&amp;#39;&lt;/span&gt;)) {
              config.headers.Authorization = &lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;Bearer &amp;#39;&lt;/span&gt; + localStorageService.get(&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;token&amp;#39;&lt;/span&gt;);
          }
          &lt;span style=&#34;color: #0000aa&#34;&gt;return&lt;/span&gt; config || $q.when(config);
      },
      response: &lt;span style=&#34;color: #0000aa&#34;&gt;function&lt;/span&gt;(response) {
          &lt;span style=&#34;color: #0000aa&#34;&gt;return&lt;/span&gt; response || $q.when(response);
      },
      responseError: &lt;span style=&#34;color: #0000aa&#34;&gt;function&lt;/span&gt;(rejection) {
          &lt;span style=&#34;color: #0000aa&#34;&gt;if&lt;/span&gt; (rejection.status == &lt;span style=&#34;color: #009999&#34;&gt;401&lt;/span&gt;) {
              $location.path(&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;quot;/login&amp;quot;&lt;/span&gt;);
          }
          &lt;span style=&#34;color: #0000aa&#34;&gt;return&lt;/span&gt; $q.reject(rejection);
      }
  };
});

app.config(&lt;span style=&#34;color: #0000aa&#34;&gt;function&lt;/span&gt; ($httpProvider) {
  $httpProvider.interceptors.push(&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;AuthInterceptor&amp;#39;&lt;/span&gt;);
});
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The idea is simple. For every HTTP request, if the token exists in local storage, we set the token in the HTTP Authorization header. Otherwise the header would not be set and a 401 response will be expected when we tried to access a restricted page.&lt;/p&gt;

&lt;p&gt;We also deal with intercepting responses here. For every responses with status 401 (meaning unauthorized), we direct the user to the login page.&lt;/p&gt;

&lt;p&gt;All in all, &lt;code&gt;auth-interceptor.js&lt;/code&gt; essentially takes care of the authorization process for you.&lt;/p&gt;

&lt;p&gt;Having done the necessary plumbing to make authentication work. We will create a restricted view that only logged-in users can access. The restricted view will contain a raw JSON response of all the user data.&lt;/p&gt;

&lt;p&gt;First, we create a controller to fetch the user data from the API in &lt;code&gt;scripts/controllers/users.js&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #ffffff&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;app.controller(&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;UsersCtrl&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color: #0000aa&#34;&gt;function&lt;/span&gt;($scope, $http) {
  $http.get(&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;#39;http://localhost:3000/users&amp;#39;&lt;/span&gt;).success(&lt;span style=&#34;color: #0000aa&#34;&gt;function&lt;/span&gt;(data) {
    $scope.users = data;
  });
});
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We are calling the restricted API endpoint here. If the user is authorized, display the data, otherwise the user will be redirected to the log-in page by &lt;code&gt;auth-interceptor.js&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;To finally create the restricted view (&lt;code&gt;views/users.html&lt;/code&gt;) is very simple. Just add the string interpolations as shown below:&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #ffffff&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;&amp;lt;&lt;span style=&#34;color: #1e90ff; font-weight: bold&#34;&gt;div&lt;/span&gt;&amp;gt;
  { { users } }
  &lt;span style=&#34;color: #aaaaaa; font-style: italic&#34;&gt;&amp;lt;!-- please remove spacing between curly brackets! --&amp;gt;&lt;/span&gt;
&amp;lt;/&lt;span style=&#34;color: #1e90ff; font-weight: bold&#34;&gt;div&lt;/span&gt;&amp;gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id=&#34;conclusion&#34;&gt;Conclusion&lt;/h3&gt;

&lt;p&gt;You may notice that we didn’t create any links for our routes; we have to type in the URL path manually in the address bar every time we want to test the auth. Implementing the links is left as an exercise for the diligent reader.&lt;/p&gt;

&lt;p&gt;There is one more thing though. We have to tell Angular where to load up our controllers and services by adding those dependencies in &lt;code&gt;index.html&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #ffffff&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;    &lt;span style=&#34;color: #aaaaaa; font-style: italic&#34;&gt;&amp;lt;!-- build:js({.tmp,app}) scripts/scripts.js --&amp;gt;&lt;/span&gt;
    &amp;lt;&lt;span style=&#34;color: #1e90ff; font-weight: bold&#34;&gt;script&lt;/span&gt; &lt;span style=&#34;color: #1e90ff&#34;&gt;src&lt;/span&gt;=&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;quot;scripts/app.js&amp;quot;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span style=&#34;color: #1e90ff; font-weight: bold&#34;&gt;script&lt;/span&gt;&amp;gt;
    &amp;lt;&lt;span style=&#34;color: #1e90ff; font-weight: bold&#34;&gt;script&lt;/span&gt; &lt;span style=&#34;color: #1e90ff&#34;&gt;src&lt;/span&gt;=&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;quot;scripts/controllers/main.js&amp;quot;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span style=&#34;color: #1e90ff; font-weight: bold&#34;&gt;script&lt;/span&gt;&amp;gt;
    &amp;lt;&lt;span style=&#34;color: #1e90ff; font-weight: bold&#34;&gt;script&lt;/span&gt; &lt;span style=&#34;color: #1e90ff&#34;&gt;src&lt;/span&gt;=&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;quot;scripts/controllers/about.js&amp;quot;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span style=&#34;color: #1e90ff; font-weight: bold&#34;&gt;script&lt;/span&gt;&amp;gt;
    &amp;lt;&lt;span style=&#34;color: #1e90ff; font-weight: bold&#34;&gt;script&lt;/span&gt; &lt;span style=&#34;color: #1e90ff&#34;&gt;src&lt;/span&gt;=&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;quot;scripts/controllers/login.js&amp;quot;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span style=&#34;color: #1e90ff; font-weight: bold&#34;&gt;script&lt;/span&gt;&amp;gt;
    &amp;lt;&lt;span style=&#34;color: #1e90ff; font-weight: bold&#34;&gt;script&lt;/span&gt; &lt;span style=&#34;color: #1e90ff&#34;&gt;src&lt;/span&gt;=&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;quot;scripts/controllers/signup.js&amp;quot;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span style=&#34;color: #1e90ff; font-weight: bold&#34;&gt;script&lt;/span&gt;&amp;gt;
    &amp;lt;&lt;span style=&#34;color: #1e90ff; font-weight: bold&#34;&gt;script&lt;/span&gt; &lt;span style=&#34;color: #1e90ff&#34;&gt;src&lt;/span&gt;=&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;quot;scripts/controllers/signout.js&amp;quot;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span style=&#34;color: #1e90ff; font-weight: bold&#34;&gt;script&lt;/span&gt;&amp;gt;
    &amp;lt;&lt;span style=&#34;color: #1e90ff; font-weight: bold&#34;&gt;script&lt;/span&gt; &lt;span style=&#34;color: #1e90ff&#34;&gt;src&lt;/span&gt;=&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;quot;scripts/controllers/users.js&amp;quot;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span style=&#34;color: #1e90ff; font-weight: bold&#34;&gt;script&lt;/span&gt;&amp;gt;
    &amp;lt;&lt;span style=&#34;color: #1e90ff; font-weight: bold&#34;&gt;script&lt;/span&gt; &lt;span style=&#34;color: #1e90ff&#34;&gt;src&lt;/span&gt;=&lt;span style=&#34;color: #aa5500&#34;&gt;&amp;quot;scripts/services/auth-interceptor.js&amp;quot;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span style=&#34;color: #1e90ff; font-weight: bold&#34;&gt;script&lt;/span&gt;&amp;gt;
    &lt;span style=&#34;color: #aaaaaa; font-style: italic&#34;&gt;&amp;lt;!-- endbuild --&amp;gt;&lt;/span&gt;
&amp;lt;/&lt;span style=&#34;color: #1e90ff; font-weight: bold&#34;&gt;body&lt;/span&gt;&amp;gt;
&amp;lt;/&lt;span style=&#34;color: #1e90ff; font-weight: bold&#34;&gt;html&lt;/span&gt;&amp;gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;This concludes my tutorial finally.&lt;/p&gt;

&lt;p&gt;To play with the auth, start the frontend and backend servers with grunt serve and rails s respectively and type any of the URLs in the address bar:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;/signup&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;/login&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;/signout&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;/restricted&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Have fun!&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>